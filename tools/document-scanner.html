<!doctype html><html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'><title>Document Scanner</title>
<link rel='stylesheet' href='../style.css'><style>body{margin:0;padding:18px;font-family:Inter,Arial;color:#0b1220}video{max-width:100%;border-radius:8px;margin-top:10px}</style></head><body>
<div><h2>Document Scanner</h2><p class='small'>Use camera or upload images. Capture multiple pages and convert to PDF.</p><input id='files' type='file' accept='image/*' multiple style='margin-top:12px'><br><video id='camera' autoplay playsinline style='display:none;margin-top:10px'></video><div style='margin-top:10px'><button class='btn' id='cameraBtn'>Start Camera</button> <button class='btn' id='captureBtn' style='display:none'>Capture Page</button> <button class='btn' id='scanBtn'>Generate PDF</button></div><div id='thumbs' style='margin-top:12px;display:flex;gap:8px;flex-wrap:wrap'></div></div>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'></script><script>try{parent.postMessage({type:'activate', href:'tools/document-scanner.html'}, location.origin);}catch(e){};let stream,captured=[];const video=document.getElementById('camera');document.getElementById('cameraBtn').addEventListener('click',async ()=>{if(!stream){try{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:'environment'}});video.srcObject=stream;video.style.display='block';document.getElementById('captureBtn').style.display='inline-block';document.getElementById('cameraBtn').textContent='Stop Camera';}catch(e){alert('Camera not available or permission denied');}}else{stream.getTracks().forEach(t=>t.stop());stream=null;video.style.display='none';document.getElementById('captureBtn').style.display='none';document.getElementById('cameraBtn').textContent='Start Camera';}});document.getElementById('captureBtn').addEventListener('click',()=>{const c=document.createElement('canvas');c.width=video.videoWidth;c.height=video.videoHeight;c.getContext('2d').drawImage(video,0,0);const data=c.toDataURL('image/png');captured.push(data);const img=document.createElement('img');img.src=data;img.style.width='120px';img.style.borderRadius='6px';document.getElementById('thumbs').appendChild(img);});document.getElementById('files').addEventListener('change',(e)=>{const files=e.target.files;for(let f of files){const reader=new FileReader();reader.onload=(ev)=>{captured.push(ev.target.result);const img=document.createElement('img');img.src=ev.target.result;img.style.width='120px';img.style.borderRadius='6px';document.getElementById('thumbs').appendChild(img);};reader.readAsDataURL(f);}});document.getElementById('scanBtn').addEventListener('click',async ()=>{const { jsPDF } = window.jspdf;const filesInput=document.getElementById('files').files;for(let f of filesInput){captured.push(await new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f);}));}if(captured.length===0){alert('No pages captured or uploaded');return;}const pdf=new jsPDF({ unit:'pt', format:'a4' });for(let i=0;i<captured.length;i++){const data=captured[i];const img=new Image();img.src=data;await new Promise(r=>img.onload=r);const pageW=pdf.internal.pageSize.getWidth();const pageH=pdf.internal.pageSize.getHeight();const ratio=Math.min(pageW/img.width,pageH/img.height);const w=img.width*ratio;const h=img.height*ratio;const x=(pageW-w)/2;const y=(pageH-h)/2;if(i>0) pdf.addPage();const type=data.indexOf('image/png')!==-1?'PNG':'JPEG';pdf.addImage(data,type,x,y,w,h);}pdf.save('ScannedDocument.pdf');});</script></body></html>